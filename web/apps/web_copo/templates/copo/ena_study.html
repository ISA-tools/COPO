{% extends 'copo/base.html' %}

{% load staticfiles %}
{% load web_tags %}
{% load html_tags %}

{% block stylesheet_block %}
    <link rel="stylesheet" href="{% static 'copo/css/copo/browse_style.css' %}">

    <link rel="stylesheet" href="{% static 'copo/css/bootstrap/bootstrapValidator.css' %}">

    <!-- Generic page styles -->
    <link rel="stylesheet" href="{% static 'copo/css/copo/style.css' %}">
    <!-- blueimp Gallery styles -->
    <link rel="stylesheet" href="//blueimp.github.io/Gallery/css/blueimp-gallery.min.css">
    <!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
    <link rel="stylesheet" href="{% static 'copo/css/uploader/jquery.fileupload.css' %}">
    <link rel="stylesheet" href="{% static 'copo/css/uploader/jquery.fileupload-ui.css' %}">
    <!-- CSS adjustments for browsers with JavaScript disabled -->
    <noscript>
        <link rel="stylesheet" href="{% static 'copo/css/uploader/jquery.fileupload-noscript.css' %}">
    </noscript>
    <noscript>
        <link rel="stylesheet" href="{% static 'copo/css/jquery.fileupload-ui-noscript.css' %}">
    </noscript>
    <link rel="stylesheet" href="{% static 'copo/css/copo/collection.css' %}">
    <link rel="stylesheet" href="{% static 'copo/css/copo/study.css' %}">

{% endblock %}


{% block title %} ENA Study {% endblock %}

{% block tagline_block %}{% endblock %}

{% block breadcrumb_block %}
    <ol class="breadcrumb">
        <li><a href="{% url 'copo:index' %}">Home</a></li>
        <li><a title="{{ profile.title  }}" href="{% url 'copo:view_profile' profile_id=profile_id %}">Profile</a></li>
        <li class="active"><a title="ENA Submission: {{ collection_head.name }}"
                              href="{% url 'copo:view_collection' collection_head_id=collection_head_id %}">Collection</a></li>
{#        <li><a href="{% url 'copo:view_study' study_id=study_id %}">Study</a></li>#}
    </ol>
{% endblock %}

{% block browse_header_block %}

    <div hidden id="hidden_attrs">

        <!-- hidden attributes required to make the page remember where it is and what its dealing with -->

        <input type="hidden" id="study_id" value="{{ study_id }}"/>

        <input type="hidden" id="attr_counter" value="1"/>

        <input type="hidden" id="sample_attr_counter" value="1"/>

        <input type="hidden" id="file_id" value=""/>

        <!-- this hidden field is to keep track of the number of upload info divs currently displaying-->
        <input type="hidden" id="upload_info_count" value="0"/>

        <input type="hidden" id="zipping_image" value="{% static 'copo/img/pacman.gif' %}"/>

        <input type="hidden" id="hashing_image" value="{% static 'copo/img/pacman.gif' %}"/>

        {% csrf_token %}

        <input type="hidden" id="upload_counter" value="1"/>


    </div>

    <div id="browse_header">
        <span class="blue_icon">
           <a><i class="fa fa-plus-circle" data-toggle="modal" data-target="#newStudyModal"></i></a>
        </span>
        <span class="blue_icon">
            <a><i class="fa fa-pencil-square-o"></i></a>
        </span>
        <span class="blue_icon">
            <a><i class="fa fa-trash-o"></i></a>
        </span>

        <div class="input-group input-group-sm">
            <span class="input-group-addon">
                <i class="fa fa-search"></i>
            </span>
            <input type="search" class="form-control" placeholder="Search">
        </div>
    </div>

{% endblock %}

{% block work_area %}

    <h2 class="h2"><span>{{ study.name|lookup_study_type_label }} /{{ pos_index }}</span></h2>

    <div class="panel-group" id="accordion">

        <!-- Panel for Study Details -->
        <div class="panel panel-default" id="panel0">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-target="#collapse0" href="#collapse0">
                        Study Details
                    </a>
                </h4>
            </div>
            <div id="collapse0" class="panel-collapse collapse in">
                <div class="panel-body">
                    {% for sf in ena_d.fields %}
                        <div class='form-group'>
                            {{ sf.id|generate_ena_tags }}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Panel for Study Contacts -->
        <div class="panel panel-default" id="panel1">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-target="#collapseOne" href="#collapseOne">
                        Study Contacts
                    </a>
                </h4>
            </div>
            <div id="collapseOne" class="panel-collapse collapse in">
                <div class="panel-body">
                    <div style="display: inline-block; text-indent: 0.5em;">
                        <a data-toggle="modal" data-target="#newStudySampleModal" id="study_sample_add" href="#"><i
                                class="glyphicon glyphicon-plus "></i><span>Add Study Contacts</span></a>
                    </div>
                    <hr/>

                    {% if study.studyContacts %}

                        <table class="table-bordered">
                            <tr>
                                {% for sf in ena_d.studySamples.fields %}
                                    <th>{{ sf.id|generate_ena_labels }}</th>
                                {% endfor %}
                                {% for sf in ena_d.studySamples.sampleCollection.fields %}
                                    <th>{{ sf.id|generate_ena_labels }}</th>
                                {% endfor %}
                                <th>&nbsp;</th>
                            </tr>

                            {% for st in study.copoInternal.sampleTypes %}
                                <tr id="{{ st.ref }}">
                                    {% for sf in ena_d.studySamples.fields %}
                                        <td>{{ st.ref|add_strings:study_id|get_sample_type_value:sf.id }}</td>
                                    {% endfor %}
                                    {% for sf in ena_d.studySamples.sampleCollection.fields %}
                                        <td>{{ st.ref|add_strings:study_id|get_sample_type_value:sf.id }}</td>
                                    {% endfor %}

                                    <td><a class="sample_type_view" href="#" title="Edit Sample">
                                    <i class="fa fa-pencil-square-o"></i></a>&nbsp;&nbsp;
                                    <a class="type_remove" href="#" title="Delete Sample">
                                        <i class="glyphicon glyphicon-remove "></i></a></td>
                                </tr>
                            {% endfor %}
                        </table>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Panel for Study Publications -->
        <div class="panel panel-default" id="panel2">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-target="#collapseTwo" href="#collapseTwo">
                        Study Publications
                    </a>
                </h4>
            </div>
            <div id="collapseTwo" class="panel-collapse collapse in">
                <div class="panel-body">
                    <div style="display: inline-block; text-indent: 0.5em;">
                        <a data-toggle="modal" data-target="#newStudyTypeModal" href="#"><i
                                class="glyphicon glyphicon-plus "></i><span>Add Study Publication</span></a>
                    </div>
                    <hr/>

                    {% if study.studyContacts %}
                        <table class="table-bordered">

                            <tr>
                                <th>Study Type</th>
                                <th>Study Samples</th>
                                <th>&nbsp;</th>
                            </tr>

                            {% for st in study.copoInternal.studyTypes %}
                                <tr id="{{ st.ref }}">
                                    <td>
                                        <a class="study_type_details" href="{% url 'copo:view_study' study_id=st.ref %}">{{ st.name|lookup_study_type_label }}
                                            /{{ forloop.counter0 }}</a>
                                    </td>
                                    <td>{{ st.ref|get_study_samples:collection_id }}</td>
                                    <td><a class="study_type_view" href="#" title="Quick View Study">
                                        <i class="glyphicon glyphicon-eye-open "></i></a>&nbsp;&nbsp;
                                        <a class="study_type_edit" href="#" title="Update Study Details">
                                        <i class="fa fa-pencil-square-o"></i></a>&nbsp;&nbsp;
                                        <a class="type_remove" href="#" title="Delete Study">
                                            <i class="glyphicon glyphicon-remove "></i></a></td>
                                </tr>
                            {% endfor %}
                        </table>
                    {% endif %}


                </div>
            </div>
        </div>
    </div>


    <!-- Modal for adding new study type -->
    <div class="modal fade" id="newStudyTypeModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span
                            aria-hidden="true">&times;</span><span
                            class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="myModalLabel">Add Study Type</h4>
                </div>
                <div class="modal-body">
                    <form role="form" id="add_new_study_form" action="{% url 'copo:add_to_collection' %}" method="post">
                        {% csrf_token %}
                        <div>
                            <div class="form-group">
                                <label for="add_study_type">Add New</label><br/>
                                {% for stud in study_types %}
                                    <input type="checkbox" name="add_new_study_type" value="{{ stud.value }}">&nbsp;
                                    {{ stud.label }}<br/>
                                {% endfor %}
                            </div>
                            <div>
                                <button id="btn_add_new_study_type" type="button"
                                        class="btn btn-primary text-center">Add
                                </button>
                            </div>
                            <hr/>

                            <div class="form-group">
                                <label for="clone_study_type">Clone Existing</label><br/>
                                {% for st in study.copoInternal.studyTypes %}
                                    <input type="checkbox" name="clone_study_type" value="{{ st.ref }}">&nbsp;
                                    {{ st.name|lookup_study_type_label }} /{{ forloop.counter0 }}<br/>
                                {% endfor %}
                            </div>
                            <div>
                                <button id="btn_clone_study_type" type="button"
                                        class="btn btn-primary text-center">Clone
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">

                </div>
            </div>
        </div>
    </div>

    <!-- Modal for adding new study sample -->
    <div class="modal fade" id="newStudySampleModal" tabindex="-1" role="dialog" aria-labelledby="mySampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span
                            aria-hidden="true">&times;</span><span
                            class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="mySampleModalLabel">Add Study Sample</h4>
                </div>
                <div class="modal-body">
                    <form role="form" id="add_new_study_sample_form" action="{% url 'copo:add_to_collection' %}"
                          method="post">
                        {% csrf_token %}
                        <div>
                            {% for sf in ena_d.studySamples.fields %}
                                <div class='form-group'>
                                    {{ sf.id|generate_ena_tags }}
                                </div>
                            {% endfor %}

                            {% for sf in ena_d.studySamples.sampleCollection.fields %}
                                <div class='form-group'>
                                    {{ sf.id|generate_ena_tags }}
                                </div>
                            {% endfor %}

                            <hr/>

                            <div class="form-group">
                                <label for="assigned_study_type">Assign to...</label><br/>
                                {% for st in study.copoInternal.studyTypes %}
                                    <input type="checkbox" name="assigned_study_type" value="{{ st.ref }}">&nbsp;
                                    {{ st.name|lookup_study_type_label }} /{{ forloop.counter0 }}<br/>
                                {% endfor %}
                            </div>

                            <div>
                                <button id="btn_add_new_study_sample" type="button"
                                        class="btn btn-primary text-center">Add Sample
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">

                </div>
            </div>
        </div>
    </div>


{% endblock %}


{% block js_block %}
    <script src="{% static 'copo/js/collection_ext.js' %}"></script>
    <script src="{% static 'copo/js/jquery.form.js' %}"></script>
    <script src="{% static 'copo/js/bootstrapValidator.js' %}"></script>
    <script src="{% static 'copo/js/uploader/vendor/jquery.ui.widget.js' %}"></script>
    <script src="{% static 'copo/js/uploader/jquery.iframe-transport.js' %}"></script>
    <script src="{% static 'copo/js/uploader/jquery.fileupload.js' %}"></script>
    <script src="{% static 'copo/js/uploader/vendor/jquery.ui.widget.js' %}"></script>
    <script src="{% static 'copo/js/uploader/jquery.iframe-transport.js' %}"></script>
    <script src="{% static 'copo/js/uploader/jquery.fileupload.js' %}"></script>
    <script src="{% static 'copo/js/uploader/jquery.fileupload-process.js' %}"></script>
    <script src="{% static 'copo/js/uploader/jquery.fileupload-ui.js' %}"></script>
    <script src="{% static 'copo/js/uploader/upload_wrapper.js' %}"></script>
    <script src="{% static 'copo/js/uploader/bootstrap_panel.js' %}"></script>
    <script src="{% static 'copo/js/uploader/upload_util.js' %}"></script>

{% endblock %}