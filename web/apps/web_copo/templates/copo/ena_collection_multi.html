{% extends 'copo/base.html' %}

{% load staticfiles %}
{% load web_tags %}
{% load html_tags %}

{% block stylesheet_block %}
    <link rel="stylesheet" href="{% static 'copo/css/copo/browse_style.css' %}">

    <link rel="stylesheet" href="{% static 'copo/css/bootstrap/bootstrapValidator.css' %}">

    <!-- Generic page styles -->
    <link rel="stylesheet" href="{% static 'copo/css/copo/style.css' %}">
    <!-- blueimp Gallery styles -->
    <link rel="stylesheet" href="//blueimp.github.io/Gallery/css/blueimp-gallery.min.css">
    <!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
    <link rel="stylesheet" href="{% static 'copo/css/uploader/jquery.fileupload.css' %}">
    <link rel="stylesheet" href="{% static 'copo/css/uploader/jquery.fileupload-ui.css' %}">
    <!-- CSS adjustments for browsers with JavaScript disabled -->
    <noscript>
        <link rel="stylesheet" href="{% static 'copo/css/uploader/jquery.fileupload-noscript.css' %}">
    </noscript>
    <noscript>
        <link rel="stylesheet" href="{% static 'copo/css/jquery.fileupload-ui-noscript.css' %}">
    </noscript>
    <link rel="stylesheet" href="{% static 'copo/css/copo/collection.css' %}">
    <link rel="stylesheet" href="{% static 'copo/css/copo/study.css' %}">

{% endblock %}


{% block title %} ENA Collection {% endblock %}

{% block tagline_block %}{% endblock %}

{% block breadcrumb_block %}
    <ol class="breadcrumb">
        <li><a href="{% url 'copo:index' %}">Home</a></li>
        <li><a title="{{ profile.title }}" href="{% url 'copo:view_profile' profile_id=profile_id %}">Profile</a></li>
        <li class="active"><a title="ENA Submission"
                              href="{% url 'copo:view_collection' collection_head_id=collection_head_id %}">Collection</a>
        </li>
    </ol>
{% endblock %}

{% block browse_header_block %}

    <div hidden id="hidden_attrs">

        <!-- hidden attributes required to make the page remember where it is and what its dealing with -->
        <input type="hidden" id="collection_head_id" name="collection_head_id" value="{{ collection_head_id }}">

        <input type="hidden" id="ena_collection_id" value="{{ ena_collection_id }}"/>

        <input type="hidden" id="attr_counter" value="1"/>

        <input type="hidden" id="sample_attr_counter" value="1"/>

        <input type="hidden" id="file_id" value=""/>

        <!-- this hidden field is to keep track of the number of upload info divs currently displaying-->
        <input type="hidden" id="upload_info_count" value="0"/>

        <input type="hidden" id="zipping_image" value="{% static 'copo/img/pacman.gif' %}"/>

        <input type="hidden" id="hashing_image" value="{% static 'copo/img/pacman.gif' %}"/>

        {% csrf_token %}
        <input type="hidden" id="upload_counter" value="1"/>

        <input type="hidden" id="current_sample_id" value=""/>
        <input type="hidden" id="current_sample_task" value=""/>
        <input type="hidden" id="sample_data_count" value="{{ sample_data.data|length }}"/>
        <input type="hidden" id="study_data_count" value="{{ study_data|length }}"/>

    </div>

    <div id="browse_header">
        <span class="blue_icon">
           <a><i class="fa fa-plus-circle" data-toggle="modal" data-target="#newStudyModal"></i></a>
        </span>
        <span class="blue_icon">
            <a><i class="fa fa-pencil-square-o"></i></a>
        </span>
        <span class="blue_icon">
            <a><i class="fa fa-trash-o"></i></a>
        </span>

        <div class="input-group input-group-sm">
            <span class="input-group-addon">
                <i class="fa fa-search"></i>
            </span>
            <input type="search" class="form-control" placeholder="Search">
        </div>
    </div>

{% endblock %}

{% block work_area %}

    <h2 class="h2"><span title="Profile Name">{{ profile.title }}</span> / <span
            title="Collection Name">{{ collection_head.name }}</span></h2>


    <div class="panel-group" id="accordion">

        <!-- Panel for Study Samples -->
        <div class="panel panel-default" id="panel1">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-target="#collapseOne" href="#collapseOne">
                        Samples
                    </a>
                </h4>
            </div>
            <div id="collapseOne" class="panel-collapse collapse in">
                <div class="panel-body">
                    <div style="display: inline-block; text-indent: 0.5em;">
                        <a class="type_add" data-toggle="modal" data-target="#newStudySampleModal" href="#">
                            <button type="button" id="btn_study_type_quick_update" class="btn btn-primary btn-xs">Add
                                Sample
                            </button>
                        </a>
                    </div>
                    <div id="samples_table_div">
                        <hr/>
                        <table class="table-bordered" id="samples_table">
                            <tr>
                                {% for sh in sample_data.headers|slice:"1:" %}
                                    <th>{{ sh }}</th>
                                {% endfor %}
                            </tr>
                            {% for sdata in sample_data.data %}
                                <tr>
                                    {% for sd in sdata|slice:"1:" %}
                                        {% if forloop.first %}
                                            <td><a id="samplerow_{{ sdata.0 }}" class="sample_edit" href="#"
                                                   title="Edit Sample">{{ sd }}</a></td>
                                        {% else %}
                                            <td>{{ sd }}</td>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                            {% endfor %}
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel for Study Types -->
        <div class="panel panel-default" id="panel2">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-target="#collapseTwo" href="#collapseTwo">
                        Studies
                    </a>
                </h4>
            </div>
            <div id="collapseTwo" class="panel-collapse collapse in">
                <div class="panel-body">
                    <div style="display: inline-block; text-indent: 0.5em;">
                        <a data-toggle="modal" data-target="#newStudyTypeModal" href="#">
                            <button type="button" id="btn_study_type_quick_update" class="btn btn-primary btn-xs">Add
                                Study
                            </button>
                        </a>
                    </div>

                    <div id="studies_table_div">
                        <hr/>
                        <table class="table-bordered" id="study_table">
                            <tr>
                                <th>Study Reference</th>
                                <th>Study Type</th>
                                <th># Samples</th>
                                <th>&nbsp;</th>
                            </tr>
                            {% for sd in study_data %}
                                <tr class="study_table_row" id="study_row_{{ sd.id }}">
                                    <td>
                                        <a href="{% url 'copo:view_study' study_id=sd.id %}">{{ sd.studyReference }}</a>
                                    </td>
                                    <td>{{ sd.studyType }}</td>
                                    <td>{{ sd.samplescount }}</td>
                                    <td><a id="stview_{{ sd.id }}" class="study_type_view" href="#"
                                           title="Quick View Study">
                                        <i class="glyphicon glyphicon-eye-open "></i></a>&nbsp;&nbsp;
                                        <a id="stupdate_{{ sd.id }}" class="study_type_edit" href="#"
                                           title="Update Study Details">
                                            <i class="fa fa-pencil-square-o"></i></a>&nbsp;&nbsp;
                                        <a id="stdelete_{{ sd.id }}" class="type_remove" href="#"
                                           title="Delete Study">
                                            <i class="glyphicon glyphicon-remove "></i></a></td>
                                </tr>
                            {% endfor %}
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal for adding new study type -->
    <div class="modal fade copo-modal2 " id="newStudyTypeModal" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span
                            aria-hidden="true">&times;</span><span
                            class="sr-only">Close</span></button>
                    <div style="display: inline-block;"><h4 class="modal-title" id="myModalLabel">Add Study Type</h4>
                    </div>
                    <div style="display: inline-block;"><span class="blue_icon"><a id="study_type_add_info" href="#"
                                                                                   class="easyui-tooltip"
                                                                                   title="{{ "study_type_add_info"|lookup_info }}"><i
                            class="glyphicon glyphicon-info-sign"></i></a></span></div>

                </div>
                <div class="modal-body">
                    <form role="form" id="add_new_study_form_2" action="{% url 'copo:add_to_collection' %}"
                          method="post">
                        {% csrf_token %}

                        <input type="hidden" name="profile_id" value="{{ profile_id }}">

                        <div id="study_type_div" class="form-group">
                            <label for="study_type">New Study Type
                                <div style="display: inline-block; text-indent: 0.5em;">
                                    <a id="study_type_add" href="#" title="Add Study Type">
                                        <button type="button" class="btn btn-default btn-xs"><i
                                                class="glyphicon glyphicon-plus "></i>Add
                                        </button>
                                    </a>
                                </div>
                            </label>

                            <div id="study_types_lists_div">
                                <div id="study_type_select_divs_0" style="white-space: nowrap; margin-bottom: 0.5em;">
                                    <div style="display: inline-block;">
                                        <select name="study_type_select_0" id="study_type_select_0"
                                                class="form-control">
                                            {% for stud in study_types %}
                                                <option value="{{ stud.value }}">{{ stud.label }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div style="display: inline-block;">
                                        <input type="text" name="study_type_reference_0" id="study_type_reference_0"
                                               class="form_control input-copo"
                                               placeholder="Enter Study Reference"/>
                                    </div>
                                    <div style="display: inline-block;">
                                        <a id="study_type_remove_0" name="study_type_remove_0" class="study_type_remove"
                                           href="#" title="Delete Study">
                                            <button type="button" class="btn btn-default btn-xs"><i
                                                    class="glyphicon glyphicon-remove "></i>Delete
                                            </button>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr/>

                        <label for="study_type_tree">Clone Existing</label><br/>

                        <div class="two-column-study-container">
                            <div class="study-column-one">
                                <ul id="study_type_tree" class="easyui-tree"
                                    checkbox="true"
                                    animate="true"
                                    lines="true">
                                </ul>
                            </div>
                            <div class="study-column-two" hidden="hidden">
                                <div id="info_panel_display"></div>
                            </div>
                            <div class="study-column-clear"></div>
                        </div>

                        <hr/>
                        <div>
                            <button id="submit_study_type_btn" type="button" class="btn btn-primary text-center">
                                Submit
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">

                </div>
            </div>
        </div>
    </div>

    <!-- Modal for adding new study sample -->
    <div class="modal fade" id="newStudySampleModal" tabindex="-1" role="dialog" aria-labelledby="mySampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span><span
                            class="sr-only">Close</span></button>

                    <div style="display: inline-block;"><h4 class="modal-title" id="mySampleModalLabel">Add Study
                        Sample</h4>
                    </div>
                    <div style="display: inline-block;"><span class="blue_icon"><a id="sample_add_info" href="#"
                                                                                   class="easyui-tooltip"
                                                                                   title="{{ "sample_add_info"|lookup_info }}"><i
                            class="glyphicon glyphicon-info-sign"></i></a></span></div>
                </div>
                <div class="modal-body">
                    <form role="form" id="add_new_study_sample_form" action="{% url 'copo:add_to_collection' %}"
                          method="post">
                        {% csrf_token %}
                        <div>
                            {% for sf in ena_d.studies.study.studySamples.fields %}
                                <div class='form-group'>
                                    {{ sf.id|generate_ena_tags }}
                                </div>
                            {% endfor %}

                            {% for sf in ena_d.studies.study.studySamples.sampleCollection.fields %}
                                <div class='form-group'>
                                    {{ sf.id|generate_ena_tags }}
                                </div>
                            {% endfor %}

                            <hr/>

                            <div class="form-group">
                                <label for="assigned_study_type">Assign to...</label><br/>
                                <ul id="study_type_sample_tree" class="easyui-tree"
                                    checkbox="true"
                                    animate="true">
                                </ul>
                            </div>
                            <hr/>
                            <div>
                                <button id="btn_add_new_sample" type="button"
                                        class="btn btn-primary text-center">Submit
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">

                </div>
            </div>
        </div>
    </div>



{% endblock %}


{% block js_block %}
    <script src="{% static 'copo/js/collection_functions.js' %}"></script>
    <script src="{% static 'copo/js/collection_ext.js' %}"></script>
    {#    <script src="{% static 'copo/js/collection.js' %}"></script>#}
    <script src="{% static 'copo/js/jquery.form.js' %}"></script>
    <script src="{% static 'copo/js/bootstrapValidator.js' %}"></script>
    <script src="{% static 'copo/js/uploader/vendor/jquery.ui.widget.js' %}"></script>
    <script src="{% static 'copo/js/uploader/jquery.iframe-transport.js' %}"></script>
    <script src="{% static 'copo/js/uploader/jquery.fileupload.js' %}"></script>
    <script src="{% static 'copo/js/uploader/vendor/jquery.ui.widget.js' %}"></script>
    <script src="{% static 'copo/js/uploader/jquery.iframe-transport.js' %}"></script>
    <script src="{% static 'copo/js/uploader/jquery.fileupload.js' %}"></script>
    <script src="{% static 'copo/js/uploader/jquery.fileupload-process.js' %}"></script>
    <script src="{% static 'copo/js/uploader/jquery.fileupload-ui.js' %}"></script>
    <script src="{% static 'copo/js/uploader/upload_wrapper.js' %}"></script>
    <script src="{% static 'copo/js/uploader/bootstrap_panel.js' %}"></script>
    <script src="{% static 'copo/js/uploader/upload_util.js' %}"></script>

{% endblock %}